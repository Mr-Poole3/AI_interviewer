# LLM面试官系统 - 简历上传功能修改方案

## 功能概述
添加用户简历上传功能，支持PDF和Word格式，后台解析文件内容并作为LLM的上下文，实现基于简历的个性化面试。

## 修改评估报告

### 修改范围
- **涉及文件**：
  - `backend/app.py` - 添加文件上传接口和解析逻辑
  - `backend/llm.py` - 修改prompt处理，支持双prompt模式
  - `static/index.html` - 添加文件上传UI组件
  - `static/app.js` - 添加文件上传和处理逻辑
  - `static/style.css` - 添加文件上传相关样式
  - `requirements.txt` - 添加新的依赖库
- **修改类型**：大范围修改
- **代码区域**：
  - WebSocket聊天逻辑（需要支持简历上下文）
  - LLM客户端类（支持双prompt模式）
  - 前端UI界面（添加上传组件）
  - 前端交互逻辑（文件处理和状态管理）

### 影响分析
- **功能影响**：
  - 增强面试官的个性化能力（基于简历内容）
  - 保持原有聊天功能的完整性
  - 新增文件上传和解析能力
- **接口变化**：
  - 新增 `/api/upload-resume` 文件上传接口
  - WebSocket消息协议扩展（支持简历上下文）
  - LLM客户端接口扩展（双prompt支持）
- **依赖影响**：
  - 增加文件解析依赖（PyPDF2, python-docx）
  - 服务器存储需求（临时文件处理）

### 修改方案

#### 第一步：更新依赖和配置
- **修改原因**：支持PDF和Word文档解析
- **具体改动**：在requirements.txt中添加PyPDF2和python-docx
- **预期效果**：具备文件解析能力

#### 第二步：扩展后端LLM客户端
- **修改原因**：支持基于简历内容的双prompt模式
- **具体改动**：
  - 修改`LLMClient.chat_stream`方法支持简历上下文
  - 添加prompt组合逻辑（简历内容+面试官指导）
- **预期效果**：LLM能根据简历内容进行个性化面试

#### 第三步：添加文件上传和解析接口
- **修改原因**：处理用户上传的简历文件
- **具体改动**：
  - 在`backend/app.py`中添加文件上传接口
  - 实现PDF和Word文档内容提取功能
  - 添加文件类型验证和安全检查
- **预期效果**：能够安全地接收和解析简历文件

#### 第四步：扩展WebSocket聊天逻辑
- **修改原因**：在聊天中集成简历上下文
- **具体改动**：
  - 修改WebSocket处理逻辑，支持简历上下文传递
  - 调整系统prompt，结合简历内容和面试官指导
- **预期效果**：面试官能基于用户简历进行针对性提问

#### 第五步：添加前端文件上传UI
- **修改原因**：提供用户友好的文件上传界面
- **具体改动**：
  - 在`index.html`中添加文件上传组件
  - 在`style.css`中添加相关样式
  - 支持拖拽上传和文件选择两种方式
- **预期效果**：用户能方便地上传简历文件

#### 第六步：实现前端文件处理逻辑
- **修改原因**：处理文件上传和状态管理
- **具体改动**：
  - 在`app.js`中添加文件上传处理函数
  - 实现上传进度显示和错误处理
  - 添加简历解析状态的UI反馈
- **预期效果**：流畅的文件上传和处理体验

### 风险评估
- **潜在风险**：
  - 文件上传安全风险（文件类型、大小限制）
  - 文件解析失败风险（损坏或格式不支持的文件）
  - 服务器存储和内存占用增加
  - 现有聊天功能可能受到影响
- **应对措施**：
  - 严格的文件类型和大小验证
  - 完善的异常处理和用户提示
  - 临时文件清理机制
  - 保持向后兼容性，无简历时使用原有逻辑
- **回滚方案**：
  - 保留原有代码结构，新功能作为可选特性
  - 通过配置开关控制新功能的启用
  - 数据库迁移脚本（如需要）

### 技术实现细节

#### 文件解析方案
```python
# PDF解析
import PyPDF2
def extract_pdf_text(file_path):
    with open(file_path, 'rb') as file:
        reader = PyPDF2.PdfReader(file)
        text = ""
        for page in reader.pages:
            text += page.extract_text()
    return text

# Word解析  
from docx import Document
def extract_docx_text(file_path):
    doc = Document(file_path)
    text = ""
    for paragraph in doc.paragraphs:
        text += paragraph.text + "\n"
    return text
```

#### 双Prompt架构
```python
def create_interview_prompt(resume_content: str) -> str:
    prompt1 = f"用户简历信息：\n{resume_content}\n\n"
    prompt2 = """你是一个专业的技术面试官。基于用户的简历信息，请：
    1. 分析候选人的技术背景和经验
    2. 针对简历中的技术栈和项目经验提出相关问题
    3. 根据职位要求评估候选人的匹配度
    4. 保持专业、友好的面试氛围
    """
    return prompt1 + prompt2
```

#### 文件安全策略
- 文件大小限制：最大10MB
- 支持格式：.pdf, .doc, .docx
- 病毒扫描：基础文件头检查
- 临时存储：上传后立即解析并删除原文件
- 内容过滤：移除敏感信息和格式字符

### 测试计划
1. **单元测试**
   - 文件解析功能测试
   - Prompt组合逻辑测试
   - 文件上传接口测试

2. **集成测试**
   - 完整的文件上传到面试流程测试
   - WebSocket通信测试
   - 错误处理测试

3. **用户体验测试**
   - 文件上传UI交互测试
   - 不同文件格式兼容性测试
   - 移动端适配测试

### 部署注意事项
- 确保服务器有足够的磁盘空间处理临时文件
- 配置适当的文件上传大小限制
- 监控内存使用情况
- 设置文件清理定时任务

---
*创建时间：2024年12月*
*状态：待实施* 